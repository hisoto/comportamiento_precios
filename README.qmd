---
title: "README"

params:
  año: 2026
  mes: 1

execute:
  echo: false
  warning: false
  message: false

format:
  gfm:
    fig-format: png
    fig-transparent: true
  html:
    fig-format: png
    fig-transparent: true
knitr:
  opts_chunk:
    dev: svg
    dev.args: { bg: "transparent" }
---

## Inflación general, subyacente y no subyacente

```{r}
pacman:::p_load(
  tidyverse, 
  dplyr,
  data.table,
  readxl,
  janitor,
  lubridate,
  haven 
)

source("rscripts/theme_conasami.R")

fecha_interes  <- ymd(sprintf("%s-%s-01", params$año, params$mes))
fecha_inicio <- "2021-01-01"

base <- fread("data/inpc.csv") 

base <- base |> 
  arrange(variable, date) |> 
  group_by(variable) |> 
  mutate(
    var_anual = ((valor / lag(valor, 12) - 1)*100),
    var_mensual = ((valor / lag(valor, 1) - 1)*100)
  ) |> 
  filter(
    date >= fecha_inicio & date <= fecha_interes
  ) 

```

Este repositorio contiene los códigos para automatizar la descarga de las series de tiempo del índice Nacional de Precios al Consumidor, y sus desagregaciones, para hacer el reporte sobre el comportamiento de los precios. 

El índice de precios al consumidor en `r month.name[params$mes]` de `r params$año` registro un valor de `r base |> filter(date == fecha_interes & variable == "INPC") |> pull(valor)`, por su parte los índices subyacente y no subyacente tuvieron un valor de `r base |> filter(date == fecha_interes & variable == "Subyacente") |> pull(valor)` y `r base |> filter(date == fecha_interes & variable == "No subyacente") |> pull(valor)`, respectivamente.

```{r}
#| out-width: "100%" 
#| dpi: 300

graph_01 <- base |> 
  filter(
     variable %in% c("INPC", "Subyacente", "No subyacente")
  )

ggplot(graph_01) + 
  geom_point(
    mapping = aes(x = date, y = var_anual, color = variable),
    shape = 1,
    show.legend = FALSE
  ) + 
  geom_line(
    mapping = aes(x = date, y = var_anual, color = variable)
  ) +
  scale_color_manual(
    values = c(
      "INPC" = "#a57f2c",
      "Subyacente" = "#611232",
      "No subyacente" = "#1e5b4f"
    )
  ) +
  scale_y_continuous(
    limits = c(-1, NA),
    breaks = seq(-10, 20, by = 2)
  ) +
  scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
  geom_abline(
    slope = 0,
    intercept = 0,
    color = "black",
    linewidth = 0.5,
    linetype = "dotted"
  ) + 
  geom_text(
    data = base %>% filter(date == fecha_interes & variable %in% c("INPC", "Subyacente", "No subyacente")),
    mapping = aes(
      x = date,
      y = var_anual,
      label = round(var_anual, 2),
      color = variable
    ),
    hjust = -0.3,
    vjust = 0,
    show.legend = FALSE, 
    fontface = "bold", 
    size = 2.5
  ) + 
  labs(
    title = "",
    subtitle = "",
    x = "",
    y = "Variación anual (%)",
    caption = "",
    color = ""
  ) +
  theme_conasami() + 
  theme(
  legend.position = "bottom", 
  text = element_text(color = "white"), 
  axis.text = element_text(color = "white"),
  axis.title = element_text(color = "white"),
  axis.ticks = element_line(color = "white")
)
```

La inflación anual para el INPC general, subyacente y no subyacente fue de `r round(base[base$date== fecha_interes & base$variable == "INPC", "var_anual"], 2)`%, `r round(base[base$date== fecha_interes & base$variable == "Subyacente", "var_anual"], 2)`% y `r round(base[base$date== fecha_interes & base$variable == "No subyacente", "var_anual"], 2)`%, respectivamente. Por su parte, las variaciones mensuales fueron de `r round(base[base$date== fecha_interes & base$variable == "INPC", "var_mensual"], 2)`%, `r round(base[base$date== fecha_interes & base$variable == "Subyacente", "var_mensual"], 2)`% y `r round(base[base$date== fecha_interes & base$variable == "No subyacente", "var_mensual"], 2)`%, respectivamente.

```{r}
#| out-width: "100%"

base |> 
  filter(
     variable %in% c("INPC", "Subyacente", "No subyacente") &
     date == fecha_interes
  ) |> 
  select(variable, date, valor, var_anual, var_mensual) |> 
  arrange(variable) |>
  knitr::kable(
    col.names = c("Variable", "Fecha", "Valor", 
                  "Variación anual (%)", 
                  "Variación mensual (%)"),
    caption = "INPC, subyacente y no subyacente al mes de interés",
    format = "pipe"
  )
  

```

Dentro de la inflación subyacente, el componente de Servicios tuvo una variación anual de `r round(base[base$date== fecha_interes & base$variable == "Subyacente - Servicios", "var_anual"], 2)`% y el de Mercancías de `r round(base[base$date== fecha_interes & base$variable == "Subyacente - Mercancias", "var_anual"], 2)`%. Por su parte, dentro del componente no subyacente, los productos agropecuarios tuvieron una variación anual de `r round(base[base$date== fecha_interes & base$variable == "No subyacente - Agropecuarios", "var_anual"], 2)`% y los energéticos y tarifas autorizadas de `r round(base[base$date== fecha_interes & base$variable == "No subyacente - Energéticos y tarifas autorizadas", "var_anual"], 2)`%.

```{r}
#| out-width: "100%"

base |> 
  filter(
     variable %in% c("Subyacente - Servicios", "Subyacente - Mercancias", "No subyacente - Agropecuarios", "No subyacente - Energéticos y tarifas autorizadas") &
     date == fecha_interes
  ) |> 
  select(variable, date, valor, var_anual, var_mensual) |> 
  arrange(variable) |>
  knitr::kable(
    col.names = c("Variable", "Fecha", "Valor", "Variación anual (%)", "Variación mensual (%)"),
    caption = "Componentes del INPC al mes de interés",
    format = "pipe"
  ) 

```

------------------------------------------------------------------------

## Canasta de consumo mínimo

La inflación de los productos de la canasta básica fue de `r round(base[base$date== fecha_interes & base$variable == "INPC CCM", "var_anual"], 2)`% anual y `r round(base[base$date== fecha_interes & base$variable == "INPC CCM", "var_mensual"], 2)`% mensual. La diferencia en puntos porcentuales entre la inflación general y la de la canasta de consumo mínimo fue de `r round(base[base$date== fecha_interes & base$variable == "INPC", "var_anual"] - base[base$date== fecha_interes & base$variable == "INPC CCM", "var_anual"], 2)` puntos porcentuales anual y `r round(base[base$date== fecha_interes & base$variable == "INPC", "var_mensual"] - base[base$date== fecha_interes & base$variable == "INPC CCM", "var_mensual"], 2)` puntos porcentuales mensual.

```{r}
#| out-width: "100%" 
#| dpi: 300

ggplot(base |> filter(variable %in% c("INPC", "INPC CCM"))) + 
  geom_point(
    mapping = aes(x = date, y = var_anual, color = variable),
    shape = 1,
    show.legend = FALSE
  ) + 
  geom_line(
    mapping = aes(x = date, y = var_anual, color = variable)
  ) + 
  scale_color_manual(
    values = c(
      "INPC" = "#a57f2c",
      "INPC CCM" = "#611232"
    )
  ) +
  scale_y_continuous(
    limits = c(-.5, NA),
    breaks = seq(-10, 20, by = 2)
  ) +
  scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
  geom_abline(
    slope = 0,
    intercept = 0,
    color = "black",
    linewidth = 0.5,
    linetype = "dotted"
  ) + 
  geom_text(
    data = base %>% filter(date == fecha_interes & variable %in% c("INPC", "INPC CCM")),
    mapping = aes(
      x = date,
      y = var_anual,
      label = round(var_anual, 2),
      color = variable,
      vjust = if_else(variable == "INPC", 1, 0),
    ),
    hjust = -0.3,
    show.legend = FALSE, 
    fontface = "bold", 
    size = 2.5
  ) + 
  labs(
    title = "",
    subtitle = "",
    x = "",
    y = "Variación anual (%)",
    caption = "",
    color = ""
  ) +
  theme_conasami() + 
  theme(
  legend.position = "bottom", 
  text = element_text(color = "white"), 
  axis.text = element_text(color = "white"),
  axis.title = element_text(color = "white"),
  axis.ticks = element_line(color = "white")
  )

```

## Productos básicos 

En esta sección se analiza el comportamiento de cinco productos básico: Tortilla, Frijol, Huevo, Leche y Carne de res. En `r month.name[params$mes]` de `r params$año`, la variación anual de estos productos fue de `r round(base[base$date== fecha_interes & base$variable == "Tortilla", "var_anual"], 2)`% para la tortilla, `r round(base[base$date== fecha_interes & base$variable == "Frijol", "var_anual"], 2)`% para el frijol, `r round(base[base$date== fecha_interes & base$variable == "Huevo", "var_anual"], 2)`% para el huevo, `r round(base[base$date== fecha_interes & base$variable == "Leche", "var_anual"], 2)`% para la leche y `r round(base[base$date== fecha_interes & base$variable == "Carne res", "var_anual"], 2)`% para la carne de res. Por su parte, las variaciones mensuales fueron de `r round(base[base$date== fecha_interes & base$variable == "Tortilla", "var_mensual"], 2)`% para la tortilla, `r round(base[base$date== fecha_interes & base$variable == "Frijol", "var_mensual"], 2)`% para el frijol, `r round(base[base$date== fecha_interes & base$variable == "Huevo", "var_mensual"], 2)`% para el huevo, `r round(base[base$date== fecha_interes & base$variable == "Leche", "var_mensual"], 2)`% para la leche y `r round(base[base$date== fecha_interes & base$variable == "Carne res", "var_mensual"], 2)`% para la carne de res.

```{r}
#| out-width: "100%" 
tabla <- base |>
  filter(date == fecha_interes & variable %in% c("INPC", "Tortilla", "Frijol", "Huevo", "Leche", "Carne res")) |>
  select(variable, date, valor, var_anual, var_mensual) |>
  arrange(variable) |>
  knitr::kable(
    col.names = c("Variable", "Fecha", "Valor", "Variación anual (%)", "Variación mensual (%)"),
    caption = "INPC, tortilla, frijol, huevo, leche y carne de res al mes de interés",
    format = "pipe"
  ) 

  tabla 
```

```{r}
#| out-width: "100%" 
#| dpi: 300

  ggplot(base |> filter(variable %in% c("INPC", "Tortilla", "Frijol", "Huevo", "Leche", "Carne res"))) + 
  geom_point(
    mapping = aes(x = date, y = var_anual, color = variable),
    shape = 1,
    show.legend = FALSE
  ) + 
  geom_line(
    mapping = aes(x = date, y = var_anual, color = variable)
  ) +
  scale_color_manual(
    values = c(
      "INPC" = "#a57f2c",
      "Tortilla" = "#611232",
      "Carne res" = "#1e5b4f",
      "Leche" = "#9b2247",
      "Carne cerdo" = "#2e6f6f",
      "Huevo" = "#161a1d",
      "Frijol" = "#98989A"
    )
  ) +
  scale_y_continuous(
    limits = c(-15, NA),
    breaks = seq(-15, 40, by = 5)
  ) +
  scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
  geom_abline(
    slope = 0,
    intercept = 0,
    color = "black",
    linewidth = 0.5,
    linetype = "dotted"
  ) + 
  geom_text(
    data = base %>% filter(date == fecha_interes & variable %in% c("INPC", "Tortilla", "Frijol", "Huevo", "Leche", "Carne res")),
    mapping = aes(
      x = date,
      y = var_anual,
      label = round(var_anual, 2),
      color = variable
    ),
    hjust = -0.3,
    show.legend = FALSE, 
    fontface = "bold", 
    size = 2
  ) +
  labs(
    title = "",
    subtitle = "",
    x = "",
    y = "Variación anual (%)",
    caption = "",
    color = ""
  ) +
  theme_conasami() + 
  guides(color = guide_legend(nrow = 2, byrow = TRUE)) +
  theme(
  legend.position = "bottom", 
  text = element_text(color = "white"), 
  axis.text = element_text(color = "white"),
  axis.title = element_text(color = "white"),
  axis.ticks = element_line(color = "white")
  )



```

## Inflación por Ciudad

```{r}

ciudad <- base |>
  filter(str_starts(api, "v_ciudad")) |> 
  arrange(variable, date) |>
  group_by(variable) |>
  mutate(
    zona = case_when(
      variable == "Nacional" ~ "Nacional",
      variable == "Cd. Juárez, Chih." ~ "ZLFN",
      variable == "Matamoros, Tamps." ~ "ZLFN",
      variable == "Cd. Acuña, Coah." ~ "ZLFN",
      variable == "Tijuana, B.C." ~ "ZLFN",
      variable == "Mexicali, B.C." ~ "ZLFN",
      TRUE ~ "ZSMG"
    )
  ) |> 
  filter(
    date == fecha_interes 
  ) 

```

La inflación promedio en las ciudades de la Zona Libre de la Frontera Norte (ZLFN) fue de `r round(ciudad |> filter(zona == "ZLFN") |> group_by(zona) |> summarise(x = mean(var_anual, na.rm = TRUE)) |> pull(x), 2)`. 

```{r}
#| out-width: "100%"

ciudad |> 
  filter(str_starts(api, "v_ciudad") & date == fecha_interes) |> 
  select(variable, date, valor, var_anual, var_mensual) |> 
  arrange(desc(var_anual)) |>
  knitr::kable(
    col.names = c("Ciudad", "Fecha", "Valor", "Variación anual (%)", "Variación mensual (%)"),
    caption = "Inflación por ciudad al mes de interés",
    format = "pipe"
  ) 

```

```{r}
#| out-width: "100%" 
#| dpi: 300

ggplot(ciudad) +
  geom_col(
    mapping = aes(x = fct_reorder(variable, -var_anual), y = var_anual, fill = zona),
    position = "dodge",
    show.legend = TRUE,
    alpha = 0.9
  ) +
  geom_text(
    mapping = aes(
      x = fct_reorder(variable, -var_anual),
      y = var_anual,
      label = round(var_anual, 2),
      color = zona,
      vjust = if_else(var_anual < 0, 1.2, -0.3)
    ),
    vjust = 0.5,
    hjust = 1.25,
    size = 2.5,
    angle = 90,
    color = "white",
    fontface = "bold",
    show.legend = FALSE
  ) +
  scale_fill_manual(
    values = c(
      "Nacional" = "#a57f2c",
      "ZLFN" = "#611232",
      "ZSMG" = "#1e5b4f"
    )) +
  scale_color_manual(
    values = c(
      "Nacional" = "#a57f2c",
      "ZLFN" = "#611232",
      "ZSMG" = "#1e5b4f"
    ))  +
  geom_abline(
    slope = 0,
    intercept = 0,
    linetype = "dashed",
    color = "gray40"
  ) +
  labs(x = "", y = "Variación mensual (%)", color = "", fill = "") +
  theme_conasami() +
  theme(
    legend.position = "bottom", 
    text = element_text(color = "white"), 
    axis.text = element_text(color = "white"),
    axis.title = element_text(color = "white"),
    axis.ticks = element_line(color = "white"),
    axis.text.x = element_text(angle = 90, hjust = 1)
    )
```

## índice Nacional de Precios al Productor

  El INPP registró una variación anual de `r round(base |> filter(variable == "INPP sin petróleo" & date == fecha_interes) |> pull(var_anual), 2)`% y una variación mensual de `r round(base |> filter(variable == "INPP sin petróleo" & date == fecha_interes) |> pull(var_mensual), 2)`% en `r month.name[params$mes]` de `r params$año`.
  
   Por grupos de actividad económica, el INPP primarias, el INPP secundarias sin petróleo y el INPP terciarias tuvieron una variación anual de `r round(base |> filter(variable == "INPP primarias" & date == fecha_interes) |> pull(var_anual), 2)`%, `r round(base |> filter(variable == "INPP secundarias sin petróleo" & date == fecha_interes) |> pull(var_anual), 2)`%, y `r round(base |> filter(variable == "INPP terciarias" & date == fecha_interes) |> pull(var_anual), 2)`%, respectivamente. Las variaciones mensuales para el INPP primarias, el INPP secundarias sin petróleo y el INPP terciarias fueron de `r round(base |> filter(variable == "INPP primarias" & date == fecha_interes) |> pull(var_mensual), 2)`%, `r round(base |> filter(variable == "INPP secundarias sin petróleo" & date == fecha_interes) |> pull(var_mensual), 2)`% y `r round(base |> filter(variable == "INPP terciarias" & date == fecha_interes) |> pull(var_mensual), 2)`%, respectivamente.


```{r}
#| out-width: "100%" 
#| dpi: 300

ggplot(
  base |> filter(variable %in% c("INPP sin petróleo", "INPP primarias", "INPP secundarias sin petróleo", "INPP terciarias"))
) + 
  geom_point(
    mapping = aes(x = date, y = var_anual, color = variable),
    shape = 1,
    show.legend = FALSE
  ) + 
  geom_line(
    mapping = aes(x = date, y = var_anual, color = variable)
  ) +
  scale_color_manual(
    values = c(
      "INPP sin petróleo" = "#a57f2c",
      "INPP primarias" = "#9b2247",
      "INPP secundarias sin petróleo" = "#611232",
      "INPP terciarias" = "#1e5b4f"
    )
  ) +
  scale_y_continuous(
    limits = c(-6, NA),
    breaks = seq(-10, 20, by = 2)
  ) +
  scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
  geom_abline(
    slope = 0,
    intercept = 0,
    color = "black",
    linewidth = 0.5,
    linetype = "dotted"
  ) +
  geom_text(
    data = base %>% filter(date == fecha_interes & variable %in% c("INPP sin petróleo", "INPP primarias", "INPP secundarias sin petróleo", "INPP terciarias")),
    mapping = aes(
      x = date,
      y = var_anual,
      label = round(var_anual, 2),
      color = variable,
      vjust = if_else(variable == "INPP secundarias sin petróleo", 1, 0)
    ),
    hjust = -0.3,
    show.legend = FALSE,
    fontface = "bold",
    size = 2.5
  ) +
  labs(
    title = "",
    subtitle = "",
    x = "",
    y = "Variación anual (%)",
    caption = "",
    color = ""
  ) +
  theme_conasami() +
  guides(color = guide_legend(nrow = 2, byrow = TRUE)) +
  theme(
    legend.position = "bottom", 
    text = element_text(color = "white"), 
    axis.text = element_text(color = "white"),
    axis.title = element_text(color = "white"),
    axis.ticks = element_line(color = "white")
  )

```

El INPP de bienes finales tuvo una variación anual de `r round(base |> filter(variable == "INPP finales" & date == fecha_interes) |> pull(var_anual), 2)`% y una variación mensual de `r round(base |> filter(variable == "INPP finales" & date == fecha_interes) |> pull(var_mensual), 2)`%. Por su parte, el INPP intermedios tuvo una variación anual de `r round(base |> filter(variable == "INPP intermedios" & date == fecha_interes) |> pull(var_anual), 2)`% y una variación mensual de `r round(base |> filter(variable == "INPP intermedios" & date == fecha_interes) |> pull(var_mensual), 2)`%.

```{r}
#| out-width: "100%" 
#| dpi: 300

ggplot(
  base |> filter(variable %in% c("INPP sin petróleo", "INPP finales", "INPP intermedios"))
) + 
  geom_point(
    mapping = aes(x = date, y = var_anual, color = variable),
    shape = 1,
    show.legend = FALSE
  ) + 
  geom_line(
    mapping = aes(x = date, y = var_anual, color = variable)
  ) +
  scale_color_manual(
    values = c(
      "INPP sin petróleo" = "#a57f2c",
      "INPP finales" = "#611232",
      "INPP intermedios" = "#1e5b4f"
    )
  ) +
  scale_y_continuous(
    limits = c(-2, NA),
    breaks = seq(-10, 20, by = 2)
  ) +
  scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
  geom_abline(
    slope = 0,
    intercept = 0,
    color = "black",
    linewidth = 0.5,
    linetype = "dotted"
  ) +
  geom_text(
    data = base %>% filter(date == fecha_interes & variable %in% c("INPP sin petróleo", "INPP finales", "INPP intermedios")),
    mapping = aes(
      x = date,
      y = var_anual,
      label = round(var_anual, 2),
      color = variable,
      vjust = case_when(
        variable == "INPP finales" ~ -1,
        variable == "INPP intermedios" ~ 1,
        TRUE ~ 0
      )
    ),
    hjust = -0.3,
    show.legend = FALSE,
    fontface = "bold",
    size = 2.5
  ) +
  labs(
    title = "",
    subtitle = "",
    x = "",
    y = "Variación anual (%)",
    caption = "",
    color = ""
  ) +
  theme_conasami() +
  guides(color = guide_legend(nrow = 2, byrow = TRUE)) +
  theme(
    legend.position = "bottom", 
    text = element_text(color = "white"), 
    axis.text = element_text(color = "white"),
    axis.title = element_text(color = "white"),
    axis.ticks = element_line(color = "white")
  )

```